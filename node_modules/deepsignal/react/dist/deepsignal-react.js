require("@preact/signals-react");var e=require("react"),t=require("@preact/signals-core"),r=require("@preact/signals-react/runtime"),n=new WeakMap,a=new WeakMap,s=new WeakMap,u=new WeakSet,o=new WeakMap,i=/^\$/,c=Object.getOwnPropertyDescriptor,l=!1,f=function(e){if(!b(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,g(e,y)),a.get(e)},g=function(e,t){var r=new Proxy(e,t);return u.add(r),r},p=function(){throw new Error("Don't mutate the signals directly.")},h=function(e){return function(r,u,o){var f;if(l)return Reflect.get(r,u,o);var p=e||"$"===u[0];if(!e&&p&&Array.isArray(r)){if("$"===u)return s.has(r)||s.set(r,g(r,v)),s.get(r);p="$length"===u}n.has(o)||n.set(o,new Map);var h=n.get(o),d=p?u.replace(i,""):u;if(h.has(d)||"function"!=typeof(null==(f=c(r,d))?void 0:f.get)){var m=Reflect.get(r,d,o);if(p&&"function"==typeof m)return;if("symbol"==typeof d&&w.has(d))return m;h.has(d)||(b(m)&&(a.has(m)||a.set(m,g(m,y)),m=a.get(m)),h.set(d,t.signal(m)))}else h.set(d,t.computed(function(){return Reflect.get(r,d,o)}));return p?h.get(d):h.get(d).value}},y={get:h(!1),set:function(e,r,s,u){var l;if("function"==typeof(null==(l=c(e,r))?void 0:l.set))return Reflect.set(e,r,s,u);n.has(u)||n.set(u,new Map);var f=n.get(u);if("$"===r[0]){s instanceof t.Signal||p();var h=r.replace(i,"");return f.set(h,s),Reflect.set(e,h,s.peek(),u)}var v=s;b(s)&&(a.has(s)||a.set(s,g(s,y)),v=a.get(s));var w=!(r in e),d=Reflect.set(e,r,s,u);return f.has(r)?f.get(r).value=v:f.set(r,t.signal(v)),w&&o.has(e)&&o.get(e).value++,Array.isArray(e)&&f.has("length")&&(f.get("length").value=e.length),d},deleteProperty:function(e,t){"$"===t[0]&&p();var r=n.get(a.get(e)),s=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),o.has(e)&&o.get(e).value++,s},ownKeys:function(e){return o.has(e)||o.set(e,t.signal(0)),o._=o.get(e).value,Reflect.ownKeys(e)}},v={get:h(!0),set:p,deleteProperty:p},w=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),d=new Set([Object,Array]),b=function(e){return"object"==typeof e&&null!==e&&d.has(e.constructor)&&!u.has(e)};exports.deepSignal=f,exports.peek=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r},exports.shallow=function(e){return u.add(e),e},exports.useDeepSignal=function(t){return r.useSignals(),e.useMemo(function(){return f(t)},[])};//# sourceMappingURL=deepsignal-react.js.map

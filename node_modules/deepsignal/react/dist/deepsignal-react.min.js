!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-react"),require("react"),require("@preact/signals-core"),require("@preact/signals-react/runtime")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-react","react","@preact/signals-core","@preact/signals-react/runtime"],t):t((e||self).deepsignalReact={},0,e.react,e.signalsCore,e.runtime)}(this,function(e,t,r,n,a){var s=new WeakMap,i=new WeakMap,o=new WeakMap,u=new WeakSet,c=new WeakMap,l=/^\$/,f=Object.getOwnPropertyDescriptor,g=!1,p=function(e){if(!R(e))throw new Error("This object can't be observed.");return i.has(e)||i.set(e,h(e,v)),i.get(e)},h=function(e,t){var r=new Proxy(e,t);return u.add(r),r},y=function(){throw new Error("Don't mutate the signals directly.")},d=function(e){return function(t,r,a){var u;if(g)return Reflect.get(t,r,a);var c=e||"$"===r[0];if(!e&&c&&Array.isArray(t)){if("$"===r)return o.has(t)||o.set(t,h(t,w)),o.get(t);c="$length"===r}s.has(a)||s.set(a,new Map);var p=s.get(a),y=c?r.replace(l,""):r;if(p.has(y)||"function"!=typeof(null==(u=f(t,y))?void 0:u.get)){var d=Reflect.get(t,y,a);if(c&&"function"==typeof d)return;if("symbol"==typeof y&&b.has(y))return d;p.has(y)||(R(d)&&(i.has(d)||i.set(d,h(d,v)),d=i.get(d)),p.set(y,n.signal(d)))}else p.set(y,n.computed(function(){return Reflect.get(t,y,a)}));return c?p.get(y):p.get(y).value}},v={get:d(!1),set:function(e,t,r,a){var o;if("function"==typeof(null==(o=f(e,t))?void 0:o.set))return Reflect.set(e,t,r,a);s.has(a)||s.set(a,new Map);var u=s.get(a);if("$"===t[0]){r instanceof n.Signal||y();var g=t.replace(l,"");return u.set(g,r),Reflect.set(e,g,r.peek(),a)}var p=r;R(r)&&(i.has(r)||i.set(r,h(r,v)),p=i.get(r));var d=!(t in e),w=Reflect.set(e,t,r,a);return u.has(t)?u.get(t).value=p:u.set(t,n.signal(p)),d&&c.has(e)&&c.get(e).value++,Array.isArray(e)&&u.has("length")&&(u.get("length").value=e.length),w},deleteProperty:function(e,t){"$"===t[0]&&y();var r=s.get(i.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),c.has(e)&&c.get(e).value++,n},ownKeys:function(e){return c.has(e)||c.set(e,n.signal(0)),c._=c.get(e).value,Reflect.ownKeys(e)}},w={get:d(!0),set:y,deleteProperty:y},b=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),m=new Set([Object,Array]),R=function(e){return"object"==typeof e&&null!==e&&m.has(e.constructor)&&!u.has(e)};e.deepSignal=p,e.peek=function(e,t){g=!0;var r=e[t];try{g=!1}catch(e){}return r},e.shallow=function(e){return u.add(e),e},e.useDeepSignal=function(e){return a.useSignals(),r.useMemo(function(){return p(e)},[])}});//# sourceMappingURL=deepsignal-react.min.js.map

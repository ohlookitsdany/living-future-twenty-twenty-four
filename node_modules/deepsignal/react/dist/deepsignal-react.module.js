import"@preact/signals-react";import{useMemo as e}from"react";import{Signal as t,signal as r,computed as n}from"@preact/signals-core";import{useSignals as a}from"@preact/signals-react/runtime";var o=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakSet,i=new WeakMap,f=/^\$/,l=Object.getOwnPropertyDescriptor,g=!1,p=function(e){if(!M(e))throw new Error("This object can't be observed.");return s.has(e)||s.set(e,y(e,d)),s.get(e)},h=function(e,t){g=!0;var r=e[t];try{g=!1}catch(e){}return r};function v(e){return c.add(e),e}var y=function(e,t){var r=new Proxy(e,t);return c.add(r),r},w=function(){throw new Error("Don't mutate the signals directly.")},m=function(e){return function(t,a,c){var i;if(g)return Reflect.get(t,a,c);var p=e||"$"===a[0];if(!e&&p&&Array.isArray(t)){if("$"===a)return u.has(t)||u.set(t,y(t,b)),u.get(t);p="$length"===a}o.has(c)||o.set(c,new Map);var h=o.get(c),v=p?a.replace(f,""):a;if(h.has(v)||"function"!=typeof(null==(i=l(t,v))?void 0:i.get)){var w=Reflect.get(t,v,c);if(p&&"function"==typeof w)return;if("symbol"==typeof v&&R.has(v))return w;h.has(v)||(M(w)&&(s.has(w)||s.set(w,y(w,d)),w=s.get(w)),h.set(v,r(w)))}else h.set(v,n(function(){return Reflect.get(t,v,c)}));return p?h.get(v):h.get(v).value}},d={get:m(!1),set:function(e,n,a,u){var c;if("function"==typeof(null==(c=l(e,n))?void 0:c.set))return Reflect.set(e,n,a,u);o.has(u)||o.set(u,new Map);var g=o.get(u);if("$"===n[0]){a instanceof t||w();var p=n.replace(f,"");return g.set(p,a),Reflect.set(e,p,a.peek(),u)}var h=a;M(a)&&(s.has(a)||s.set(a,y(a,d)),h=s.get(a));var v=!(n in e),m=Reflect.set(e,n,a,u);return g.has(n)?g.get(n).value=h:g.set(n,r(h)),v&&i.has(e)&&i.get(e).value++,Array.isArray(e)&&g.has("length")&&(g.get("length").value=e.length),m},deleteProperty:function(e,t){"$"===t[0]&&w();var r=o.get(s.get(e)),n=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),i.has(e)&&i.get(e).value++,n},ownKeys:function(e){return i.has(e)||i.set(e,r(0)),i._=i.get(e).value,Reflect.ownKeys(e)}},b={get:m(!0),set:w,deleteProperty:w},R=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),k=new Set([Object,Array]),M=function(e){return"object"==typeof e&&null!==e&&k.has(e.constructor)&&!c.has(e)},P=function(t){return a(),e(function(){return p(t)},[])};export{p as deepSignal,h as peek,v as shallow,P as useDeepSignal};//# sourceMappingURL=deepsignal-react.module.js.map

import{Signal as e,signal as t,computed as r}from"@preact/signals-core";var n=new WeakMap,a=new WeakMap,o=new WeakMap,s=new WeakSet,u=new WeakMap,f=/^\$/,c=Object.getOwnPropertyDescriptor,i=!1,l=function(e){if(!R(e))throw new Error("This object can't be observed.");return a.has(e)||a.set(e,p(e,w)),a.get(e)},g=function(e,t){i=!0;var r=e[t];try{i=!1}catch(e){}return r};function h(e){return s.add(e),e}var p=function(e,t){var r=new Proxy(e,t);return s.add(r),r},v=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(s,u,l){var g;if(i)return Reflect.get(s,u,l);var h=e||"$"===u[0];if(!e&&h&&Array.isArray(s)){if("$"===u)return o.has(s)||o.set(s,p(s,d)),o.get(s);h="$length"===u}n.has(l)||n.set(l,new Map);var v=n.get(l),y=h?u.replace(f,""):u;if(v.has(y)||"function"!=typeof(null==(g=c(s,y))?void 0:g.get)){var m=Reflect.get(s,y,l);if(h&&"function"==typeof m)return;if("symbol"==typeof y&&b.has(y))return m;v.has(y)||(R(m)&&(a.has(m)||a.set(m,p(m,w)),m=a.get(m)),v.set(y,t(m)))}else v.set(y,r(function(){return Reflect.get(s,y,l)}));return h?v.get(y):v.get(y).value}},w={get:y(!1),set:function(r,o,s,i){var l;if("function"==typeof(null==(l=c(r,o))?void 0:l.set))return Reflect.set(r,o,s,i);n.has(i)||n.set(i,new Map);var g=n.get(i);if("$"===o[0]){s instanceof e||v();var h=o.replace(f,"");return g.set(h,s),Reflect.set(r,h,s.peek(),i)}var y=s;R(s)&&(a.has(s)||a.set(s,p(s,w)),y=a.get(s));var d=!(o in r),b=Reflect.set(r,o,s,i);return g.has(o)?g.get(o).value=y:g.set(o,t(y)),d&&u.has(r)&&u.get(r).value++,Array.isArray(r)&&g.has("length")&&(g.get("length").value=r.length),b},deleteProperty:function(e,t){"$"===t[0]&&v();var r=n.get(a.get(e)),o=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),u.has(e)&&u.get(e).value++,o},ownKeys:function(e){return u.has(e)||u.set(e,t(0)),u._=u.get(e).value,Reflect.ownKeys(e)}},d={get:y(!0),set:v,deleteProperty:v},b=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),m=new Set([Object,Array]),R=function(e){return"object"==typeof e&&null!==e&&m.has(e.constructor)&&!s.has(e)};export{l as deepSignal,g as peek,h as shallow};//# sourceMappingURL=deepsignal-core.module.js.map

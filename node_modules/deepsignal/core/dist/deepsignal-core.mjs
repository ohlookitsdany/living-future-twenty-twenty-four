import{Signal as e,signal as t,computed as r}from"@preact/signals-core";const n=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakSet,l=new WeakMap,c=/^\$/,f=Object.getOwnPropertyDescriptor;let g=!1;const u=e=>{if(!R(e))throw new Error("This object can't be observed.");return s.has(e)||s.set(e,p(e,v)),s.get(e)},i=(e,t)=>{g=!0;const r=e[t];try{g=!1}catch(e){}return r};function h(e){return o.add(e),e}const p=(e,t)=>{const r=new Proxy(e,t);return o.add(r),r},y=()=>{throw new Error("Don't mutate the signals directly.")},w=e=>(o,l,u)=>{var i;if(g)return Reflect.get(o,l,u);let h=e||"$"===l[0];if(!e&&h&&Array.isArray(o)){if("$"===l)return a.has(o)||a.set(o,p(o,d)),a.get(o);h="$length"===l}n.has(u)||n.set(u,new Map);const y=n.get(u),w=h?l.replace(c,""):l;if(y.has(w)||"function"!=typeof(null==(i=f(o,w))?void 0:i.get)){let e=Reflect.get(o,w,u);if(h&&"function"==typeof e)return;if("symbol"==typeof w&&b.has(w))return e;y.has(w)||(R(e)&&(s.has(e)||s.set(e,p(e,v)),e=s.get(e)),y.set(w,t(e)))}else y.set(w,r(()=>Reflect.get(o,w,u)));return h?y.get(w):y.get(w).value},v={get:w(!1),set(r,a,o,g){var u;if("function"==typeof(null==(u=f(r,a))?void 0:u.set))return Reflect.set(r,a,o,g);n.has(g)||n.set(g,new Map);const i=n.get(g);if("$"===a[0]){o instanceof e||y();const t=a.replace(c,"");return i.set(t,o),Reflect.set(r,t,o.peek(),g)}{let e=o;R(o)&&(s.has(o)||s.set(o,p(o,v)),e=s.get(o));const n=!(a in r),c=Reflect.set(r,a,o,g);return i.has(a)?i.get(a).value=e:i.set(a,t(e)),n&&l.has(r)&&l.get(r).value++,Array.isArray(r)&&i.has("length")&&(i.get("length").value=r.length),c}},deleteProperty(e,t){"$"===t[0]&&y();const r=n.get(s.get(e)),a=Reflect.deleteProperty(e,t);return r&&r.has(t)&&(r.get(t).value=void 0),l.has(e)&&l.get(e).value++,a},ownKeys:e=>(l.has(e)||l.set(e,t(0)),l._=l.get(e).value,Reflect.ownKeys(e))},d={get:w(!0),set:y,deleteProperty:y},b=new Set(Object.getOwnPropertyNames(Symbol).map(e=>Symbol[e]).filter(e=>"symbol"==typeof e)),m=new Set([Object,Array]),R=e=>"object"==typeof e&&null!==e&&m.has(e.constructor)&&!o.has(e);export{u as deepSignal,i as peek,h as shallow};//# sourceMappingURL=deepsignal-core.mjs.map

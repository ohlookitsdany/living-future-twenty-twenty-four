!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals-core"],t):t((e||self).deepsignalCore={},e.signalsCore)}(this,function(e,t){var n=new WeakMap,r=new WeakMap,a=new WeakMap,o=new WeakSet,s=new WeakMap,i=/^\$/,u=Object.getOwnPropertyDescriptor,f=!1,l=function(e,t){var n=new Proxy(e,t);return o.add(n),n},c=function(){throw new Error("Don't mutate the signals directly.")},g=function(e){return function(o,s,c){var g;if(f)return Reflect.get(o,s,c);var d=e||"$"===s[0];if(!e&&d&&Array.isArray(o)){if("$"===s)return a.has(o)||a.set(o,l(o,h)),a.get(o);d="$length"===s}n.has(c)||n.set(c,new Map);var w=n.get(c),b=d?s.replace(i,""):s;if(w.has(b)||"function"!=typeof(null==(g=u(o,b))?void 0:g.get)){var m=Reflect.get(o,b,c);if(d&&"function"==typeof m)return;if("symbol"==typeof b&&y.has(b))return m;w.has(b)||(v(m)&&(r.has(m)||r.set(m,l(m,p)),m=r.get(m)),w.set(b,t.signal(m)))}else w.set(b,t.computed(function(){return Reflect.get(o,b,c)}));return d?w.get(b):w.get(b).value}},p={get:g(!1),set:function(e,a,o,f){var g;if("function"==typeof(null==(g=u(e,a))?void 0:g.set))return Reflect.set(e,a,o,f);n.has(f)||n.set(f,new Map);var h=n.get(f);if("$"===a[0]){o instanceof t.Signal||c();var y=a.replace(i,"");return h.set(y,o),Reflect.set(e,y,o.peek(),f)}var d=o;v(o)&&(r.has(o)||r.set(o,l(o,p)),d=r.get(o));var w=!(a in e),b=Reflect.set(e,a,o,f);return h.has(a)?h.get(a).value=d:h.set(a,t.signal(d)),w&&s.has(e)&&s.get(e).value++,Array.isArray(e)&&h.has("length")&&(h.get("length").value=e.length),b},deleteProperty:function(e,t){"$"===t[0]&&c();var a=n.get(r.get(e)),o=Reflect.deleteProperty(e,t);return a&&a.has(t)&&(a.get(t).value=void 0),s.has(e)&&s.get(e).value++,o},ownKeys:function(e){return s.has(e)||s.set(e,t.signal(0)),s._=s.get(e).value,Reflect.ownKeys(e)}},h={get:g(!0),set:c,deleteProperty:c},y=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),d=new Set([Object,Array]),v=function(e){return"object"==typeof e&&null!==e&&d.has(e.constructor)&&!o.has(e)};e.deepSignal=function(e){if(!v(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,l(e,p)),r.get(e)},e.peek=function(e,t){f=!0;var n=e[t];try{f=!1}catch(e){}return n},e.shallow=function(e){return o.add(e),e}});//# sourceMappingURL=deepsignal-core.min.js.map

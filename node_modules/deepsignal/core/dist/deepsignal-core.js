var e=require("@preact/signals-core"),t=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakSet,s=new WeakMap,o=/^\$/,u=Object.getOwnPropertyDescriptor,l=!1,i=function(e,t){var r=new Proxy(e,t);return a.add(r),r},c=function(){throw new Error("Don't mutate the signals directly.")},f=function(a){return function(s,c,f){var y;if(l)return Reflect.get(s,c,f);var w=a||"$"===c[0];if(!a&&w&&Array.isArray(s)){if("$"===c)return n.has(s)||n.set(s,i(s,p)),n.get(s);w="$length"===c}t.has(f)||t.set(f,new Map);var d=t.get(f),b=w?c.replace(o,""):c;if(d.has(b)||"function"!=typeof(null==(y=u(s,b))?void 0:y.get)){var m=Reflect.get(s,b,f);if(w&&"function"==typeof m)return;if("symbol"==typeof b&&h.has(b))return m;d.has(b)||(v(m)&&(r.has(m)||r.set(m,i(m,g)),m=r.get(m)),d.set(b,e.signal(m)))}else d.set(b,e.computed(function(){return Reflect.get(s,b,f)}));return w?d.get(b):d.get(b).value}},g={get:f(!1),set:function(n,a,l,f){var p;if("function"==typeof(null==(p=u(n,a))?void 0:p.set))return Reflect.set(n,a,l,f);t.has(f)||t.set(f,new Map);var h=t.get(f);if("$"===a[0]){l instanceof e.Signal||c();var y=a.replace(o,"");return h.set(y,l),Reflect.set(n,y,l.peek(),f)}var w=l;v(l)&&(r.has(l)||r.set(l,i(l,g)),w=r.get(l));var d=!(a in n),b=Reflect.set(n,a,l,f);return h.has(a)?h.get(a).value=w:h.set(a,e.signal(w)),d&&s.has(n)&&s.get(n).value++,Array.isArray(n)&&h.has("length")&&(h.get("length").value=n.length),b},deleteProperty:function(e,n){"$"===n[0]&&c();var a=t.get(r.get(e)),o=Reflect.deleteProperty(e,n);return a&&a.has(n)&&(a.get(n).value=void 0),s.has(e)&&s.get(e).value++,o},ownKeys:function(t){return s.has(t)||s.set(t,e.signal(0)),s._=s.get(t).value,Reflect.ownKeys(t)}},p={get:f(!0),set:c,deleteProperty:c},h=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),y=new Set([Object,Array]),v=function(e){return"object"==typeof e&&null!==e&&y.has(e.constructor)&&!a.has(e)};exports.deepSignal=function(e){if(!v(e))throw new Error("This object can't be observed.");return r.has(e)||r.set(e,i(e,g)),r.get(e)},exports.peek=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r},exports.shallow=function(e){return a.add(e),e};//# sourceMappingURL=deepsignal-core.js.map

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@preact/signals"),require("preact/hooks"),require("@preact/signals-core")):"function"==typeof define&&define.amd?define(["exports","@preact/signals","preact/hooks","@preact/signals-core"],t):t((e||self).deepsignal={},0,e.hooks,e.signalsCore)}(this,function(e,t,n,r){var a=new WeakMap,o=new WeakMap,s=new WeakMap,i=new WeakSet,u=new WeakMap,l=/^\$/,f=Object.getOwnPropertyDescriptor,c=!1,g=function(e){if(!m(e))throw new Error("This object can't be observed.");return o.has(e)||o.set(e,p(e,d)),o.get(e)},p=function(e,t){var n=new Proxy(e,t);return i.add(n),n},h=function(){throw new Error("Don't mutate the signals directly.")},y=function(e){return function(t,n,i){var u;if(c)return Reflect.get(t,n,i);var g=e||"$"===n[0];if(!e&&g&&Array.isArray(t)){if("$"===n)return s.has(t)||s.set(t,p(t,v)),s.get(t);g="$length"===n}a.has(i)||a.set(i,new Map);var h=a.get(i),y=g?n.replace(l,""):n;if(h.has(y)||"function"!=typeof(null==(u=f(t,y))?void 0:u.get)){var b=Reflect.get(t,y,i);if(g&&"function"==typeof b)return;if("symbol"==typeof y&&w.has(y))return b;h.has(y)||(m(b)&&(o.has(b)||o.set(b,p(b,d)),b=o.get(b)),h.set(y,r.signal(b)))}else h.set(y,r.computed(function(){return Reflect.get(t,y,i)}));return g?h.get(y):h.get(y).value}},d={get:y(!1),set:function(e,t,n,s){var i;if("function"==typeof(null==(i=f(e,t))?void 0:i.set))return Reflect.set(e,t,n,s);a.has(s)||a.set(s,new Map);var c=a.get(s);if("$"===t[0]){n instanceof r.Signal||h();var g=t.replace(l,"");return c.set(g,n),Reflect.set(e,g,n.peek(),s)}var y=n;m(n)&&(o.has(n)||o.set(n,p(n,d)),y=o.get(n));var v=!(t in e),w=Reflect.set(e,t,n,s);return c.has(t)?c.get(t).value=y:c.set(t,r.signal(y)),v&&u.has(e)&&u.get(e).value++,Array.isArray(e)&&c.has("length")&&(c.get("length").value=e.length),w},deleteProperty:function(e,t){"$"===t[0]&&h();var n=a.get(o.get(e)),r=Reflect.deleteProperty(e,t);return n&&n.has(t)&&(n.get(t).value=void 0),u.has(e)&&u.get(e).value++,r},ownKeys:function(e){return u.has(e)||u.set(e,r.signal(0)),u._=u.get(e).value,Reflect.ownKeys(e)}},v={get:y(!0),set:h,deleteProperty:h},w=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),b=new Set([Object,Array]),m=function(e){return"object"==typeof e&&null!==e&&b.has(e.constructor)&&!i.has(e)};e.deepSignal=g,e.peek=function(e,t){c=!0;var n=e[t];try{c=!1}catch(e){}return n},e.shallow=function(e){return i.add(e),e},e.useDeepSignal=function(e){return n.useMemo(function(){return g(e)},[])}});//# sourceMappingURL=deepsignal.min.js.map

require("@preact/signals");var e=require("preact/hooks"),t=require("@preact/signals-core"),r=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakSet,o=new WeakMap,u=/^\$/,i=Object.getOwnPropertyDescriptor,l=!1,c=function(e){if(!d(e))throw new Error("This object can't be observed.");return n.has(e)||n.set(e,f(e,h)),n.get(e)},f=function(e,t){var r=new Proxy(e,t);return s.add(r),r},g=function(){throw new Error("Don't mutate the signals directly.")},p=function(e){return function(s,o,c){var g;if(l)return Reflect.get(s,o,c);var p=e||"$"===o[0];if(!e&&p&&Array.isArray(s)){if("$"===o)return a.has(s)||a.set(s,f(s,y)),a.get(s);p="$length"===o}r.has(c)||r.set(c,new Map);var w=r.get(c),b=p?o.replace(u,""):o;if(w.has(b)||"function"!=typeof(null==(g=i(s,b))?void 0:g.get)){var m=Reflect.get(s,b,c);if(p&&"function"==typeof m)return;if("symbol"==typeof b&&v.has(b))return m;w.has(b)||(d(m)&&(n.has(m)||n.set(m,f(m,h)),m=n.get(m)),w.set(b,t.signal(m)))}else w.set(b,t.computed(function(){return Reflect.get(s,b,c)}));return p?w.get(b):w.get(b).value}},h={get:p(!1),set:function(e,a,s,l){var c;if("function"==typeof(null==(c=i(e,a))?void 0:c.set))return Reflect.set(e,a,s,l);r.has(l)||r.set(l,new Map);var p=r.get(l);if("$"===a[0]){s instanceof t.Signal||g();var y=a.replace(u,"");return p.set(y,s),Reflect.set(e,y,s.peek(),l)}var v=s;d(s)&&(n.has(s)||n.set(s,f(s,h)),v=n.get(s));var w=!(a in e),b=Reflect.set(e,a,s,l);return p.has(a)?p.get(a).value=v:p.set(a,t.signal(v)),w&&o.has(e)&&o.get(e).value++,Array.isArray(e)&&p.has("length")&&(p.get("length").value=e.length),b},deleteProperty:function(e,t){"$"===t[0]&&g();var a=r.get(n.get(e)),s=Reflect.deleteProperty(e,t);return a&&a.has(t)&&(a.get(t).value=void 0),o.has(e)&&o.get(e).value++,s},ownKeys:function(e){return o.has(e)||o.set(e,t.signal(0)),o._=o.get(e).value,Reflect.ownKeys(e)}},y={get:p(!0),set:g,deleteProperty:g},v=new Set(Object.getOwnPropertyNames(Symbol).map(function(e){return Symbol[e]}).filter(function(e){return"symbol"==typeof e})),w=new Set([Object,Array]),d=function(e){return"object"==typeof e&&null!==e&&w.has(e.constructor)&&!s.has(e)};exports.deepSignal=c,exports.peek=function(e,t){l=!0;var r=e[t];try{l=!1}catch(e){}return r},exports.shallow=function(e){return s.add(e),e},exports.useDeepSignal=function(t){return e.useMemo(function(){return c(t)},[])};//# sourceMappingURL=deepsignal.js.map

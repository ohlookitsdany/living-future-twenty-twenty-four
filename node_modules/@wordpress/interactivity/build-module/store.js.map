{"version":3,"names":["deepSignal","computed","getScope","setScope","resetScope","getNamespace","setNamespace","resetNamespace","isObject","item","Boolean","constructor","Object","deepMerge","target","source","key","getter","getOwnPropertyDescriptor","get","defineProperty","e","stores","Map","rawStores","storeLocks","storeConfigs","objToProxy","WeakMap","proxyToNs","scopeToGetters","proxify","obj","ns","has","proxy","Proxy","handlers","set","receiver","scope","getters","call","value","result","Reflect","name","args","gen","it","next","throw","done","getConfig","namespace","universalUnlock","store","state","block","lock","rawStore","proxiedStore","storeLock","isLockValid","Error","parseInitialData","dom","document","_dom$getElementById","jsonDataScriptTag","getElementById","textContent","JSON","parse","populateInitialData","data","entries","forEach","config"],"sources":["@wordpress/interactivity/src/store.ts"],"sourcesContent":["/**\n * External dependencies\n */\nimport { deepSignal } from 'deepsignal';\nimport { computed } from '@preact/signals';\n\n/**\n * Internal dependencies\n */\nimport {\n\tgetScope,\n\tsetScope,\n\tresetScope,\n\tgetNamespace,\n\tsetNamespace,\n\tresetNamespace,\n} from './hooks';\nconst isObject = ( item: unknown ): item is Record< string, unknown > =>\n\tBoolean( item && typeof item === 'object' && item.constructor === Object );\n\nconst deepMerge = ( target: any, source: any ) => {\n\tif ( isObject( target ) && isObject( source ) ) {\n\t\tfor ( const key in source ) {\n\t\t\tconst getter = Object.getOwnPropertyDescriptor( source, key )?.get;\n\t\t\tif ( typeof getter === 'function' ) {\n\t\t\t\tObject.defineProperty( target, key, { get: getter } );\n\t\t\t} else if ( isObject( source[ key ] ) ) {\n\t\t\t\tif ( ! target[ key ] ) {\n\t\t\t\t\ttarget[ key ] = {};\n\t\t\t\t}\n\t\t\t\tdeepMerge( target[ key ], source[ key ] );\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\ttarget[ key ] = source[ key ];\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\t// Assignemnts fail for properties that are only getters.\n\t\t\t\t\t// When that's the case, the assignment is simply ignored.\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const stores = new Map();\nconst rawStores = new Map();\nconst storeLocks = new Map();\nconst storeConfigs = new Map();\n\nconst objToProxy = new WeakMap();\nconst proxyToNs = new WeakMap();\nconst scopeToGetters = new WeakMap();\n\nconst proxify = ( obj: any, ns: string ) => {\n\tif ( ! objToProxy.has( obj ) ) {\n\t\tconst proxy = new Proxy( obj, handlers );\n\t\tobjToProxy.set( obj, proxy );\n\t\tproxyToNs.set( proxy, ns );\n\t}\n\treturn objToProxy.get( obj );\n};\n\nconst handlers = {\n\tget: ( target: any, key: string | symbol, receiver: any ) => {\n\t\tconst ns = proxyToNs.get( receiver );\n\n\t\t// Check if the property is a getter and we are inside an scope. If that is\n\t\t// the case, we clone the getter to avoid overwriting the scoped\n\t\t// dependencies of the computed each time that getter runs.\n\t\tconst getter = Object.getOwnPropertyDescriptor( target, key )?.get;\n\t\tif ( getter ) {\n\t\t\tconst scope = getScope();\n\t\t\tif ( scope ) {\n\t\t\t\tconst getters =\n\t\t\t\t\tscopeToGetters.get( scope ) ||\n\t\t\t\t\tscopeToGetters.set( scope, new Map() ).get( scope );\n\t\t\t\tif ( ! getters.has( getter ) ) {\n\t\t\t\t\tgetters.set(\n\t\t\t\t\t\tgetter,\n\t\t\t\t\t\tcomputed( () => {\n\t\t\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\t\t\tsetScope( scope );\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn getter.call( target );\n\t\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} )\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn getters.get( getter ).value;\n\t\t\t}\n\t\t}\n\n\t\tconst result = Reflect.get( target, key );\n\n\t\t// Check if the proxy is the store root and no key with that name exist. In\n\t\t// that case, return an empty object for the requested key.\n\t\tif ( typeof result === 'undefined' && receiver === stores.get( ns ) ) {\n\t\t\tconst obj = {};\n\t\t\tReflect.set( target, key, obj );\n\t\t\treturn proxify( obj, ns );\n\t\t}\n\n\t\t// Check if the property is a generator. If it is, we turn it into an\n\t\t// asynchronous function where we restore the default namespace and scope\n\t\t// each time it awaits/yields.\n\t\tif ( result?.constructor?.name === 'GeneratorFunction' ) {\n\t\t\treturn async ( ...args: unknown[] ) => {\n\t\t\t\tconst scope = getScope();\n\t\t\t\tconst gen: Generator< any > = result( ...args );\n\n\t\t\t\tlet value: unknown;\n\t\t\t\tlet it: IteratorResult< any >;\n\n\t\t\t\twhile ( true ) {\n\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\tsetScope( scope );\n\t\t\t\t\ttry {\n\t\t\t\t\t\tit = gen.next( value );\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvalue = await it.value;\n\t\t\t\t\t} catch ( e ) {\n\t\t\t\t\t\tsetNamespace( ns );\n\t\t\t\t\t\tsetScope( scope );\n\t\t\t\t\t\tgen.throw( e );\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tresetScope();\n\t\t\t\t\t\tresetNamespace();\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( it.done ) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is a synchronous function. If it is, set the\n\t\t// default namespace. Synchronous functions always run in the proper scope,\n\t\t// which is set by the Directives component.\n\t\tif ( typeof result === 'function' ) {\n\t\t\treturn ( ...args: unknown[] ) => {\n\t\t\t\tsetNamespace( ns );\n\t\t\t\ttry {\n\t\t\t\t\treturn result( ...args );\n\t\t\t\t} finally {\n\t\t\t\t\tresetNamespace();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\n\t\t// Check if the property is an object. If it is, proxyify it.\n\t\tif ( isObject( result ) ) {\n\t\t\treturn proxify( result, ns );\n\t\t}\n\n\t\treturn result;\n\t},\n\t// Prevents passing the current proxy as the receiver to the deepSignal.\n\tset( target: any, key: string, value: any ) {\n\t\treturn Reflect.set( target, key, value );\n\t},\n};\n\n/**\n * Get the defined config for the store with the passed namespace.\n *\n * @param namespace Store's namespace from which to retrieve the config.\n * @return Defined config for the given namespace.\n */\nexport const getConfig = ( namespace?: string ) =>\n\tstoreConfigs.get( namespace || getNamespace() ) || {};\n\ninterface StoreOptions {\n\t/**\n\t * Property to block/unblock private store namespaces.\n\t *\n\t * If the passed value is `true`, it blocks the given namespace, making it\n\t * accessible only trough the returned variables of the `store()` call. In\n\t * the case a lock string is passed, it also blocks the namespace, but can\n\t * be unblocked for other `store()` calls using the same lock string.\n\t *\n\t * @example\n\t * ```\n\t * // The store can only be accessed where the `state` const can.\n\t * const { state } = store( 'myblock/private', { ... }, { lock: true } );\n\t * ```\n\t *\n\t * @example\n\t * ```\n\t * // Other modules knowing `SECRET_LOCK_STRING` can access the namespace.\n\t * const { state } = store(\n\t *   'myblock/private',\n\t *   { ... },\n\t *   { lock: 'SECRET_LOCK_STRING' }\n\t * );\n\t * ```\n\t */\n\tlock?: boolean | string;\n}\n\nexport const universalUnlock =\n\t'I acknowledge that using a private store means my plugin will inevitably break on the next store release.';\n\n/**\n * Extends the Interactivity API global store adding the passed properties to\n * the given namespace. It also returns stable references to the namespace\n * content.\n *\n * These props typically consist of `state`, which is the reactive part of the\n * store ― which means that any directive referencing a state property will be\n * re-rendered anytime it changes ― and function properties like `actions` and\n * `callbacks`, mostly used for event handlers. These props can then be\n * referenced by any directive to make the HTML interactive.\n *\n * @example\n * ```js\n *  const { state } = store( 'counter', {\n *    state: {\n *      value: 0,\n *      get double() { return state.value * 2; },\n *    },\n *    actions: {\n *      increment() {\n *        state.value += 1;\n *      },\n *    },\n *  } );\n * ```\n *\n * The code from the example above allows blocks to subscribe and interact with\n * the store by using directives in the HTML, e.g.:\n *\n * ```html\n * <div data-wp-interactive=\"counter\">\n *   <button\n *     data-wp-text=\"state.double\"\n *     data-wp-on--click=\"actions.increment\"\n *   >\n *     0\n *   </button>\n * </div>\n * ```\n * @param namespace The store namespace to interact with.\n * @param storePart Properties to add to the store namespace.\n * @param options   Options for the given namespace.\n *\n * @return A reference to the namespace content.\n */\nexport function store< S extends object = {} >(\n\tnamespace: string,\n\tstorePart?: S,\n\toptions?: StoreOptions\n): S;\n\nexport function store< T extends object >(\n\tnamespace: string,\n\tstorePart?: T,\n\toptions?: StoreOptions\n): T;\n\nexport function store(\n\tnamespace: string,\n\t{ state = {}, ...block }: any = {},\n\t{ lock = false }: StoreOptions = {}\n) {\n\tif ( ! stores.has( namespace ) ) {\n\t\t// Lock the store if the passed lock is different from the universal\n\t\t// unlock. Once the lock is set (either false, true, or a given string),\n\t\t// it cannot change.\n\t\tif ( lock !== universalUnlock ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t}\n\t\tconst rawStore = {\n\t\t\tstate: deepSignal( isObject( state ) ? state : {} ),\n\t\t\t...block,\n\t\t};\n\t\tconst proxiedStore = new Proxy( rawStore, handlers );\n\t\trawStores.set( namespace, rawStore );\n\t\tstores.set( namespace, proxiedStore );\n\t\tproxyToNs.set( proxiedStore, namespace );\n\t} else {\n\t\t// Lock the store if it wasn't locked yet and the passed lock is\n\t\t// different from the universal unlock. If no lock is given, the store\n\t\t// will be public and won't accept any lock from now on.\n\t\tif ( lock !== universalUnlock && ! storeLocks.has( namespace ) ) {\n\t\t\tstoreLocks.set( namespace, lock );\n\t\t} else {\n\t\t\tconst storeLock = storeLocks.get( namespace );\n\t\t\tconst isLockValid =\n\t\t\t\tlock === universalUnlock ||\n\t\t\t\t( lock !== true && lock === storeLock );\n\n\t\t\tif ( ! isLockValid ) {\n\t\t\t\tif ( ! storeLock ) {\n\t\t\t\t\tthrow Error( 'Cannot lock a public store' );\n\t\t\t\t} else {\n\t\t\t\t\tthrow Error(\n\t\t\t\t\t\t'Cannot unlock a private store with an invalid lock code'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst target = rawStores.get( namespace );\n\t\tdeepMerge( target, block );\n\t\tdeepMerge( target.state, state );\n\t}\n\n\treturn stores.get( namespace );\n}\n\nexport const parseInitialData = ( dom = document ) => {\n\tconst jsonDataScriptTag =\n\t\t// Preferred Script Module data passing form\n\t\tdom.getElementById(\n\t\t\t'wp-script-module-data-@wordpress/interactivity'\n\t\t) ??\n\t\t// Legacy form\n\t\tdom.getElementById( 'wp-interactivity-data' );\n\tif ( jsonDataScriptTag?.textContent ) {\n\t\ttry {\n\t\t\treturn JSON.parse( jsonDataScriptTag.textContent );\n\t\t} catch {}\n\t}\n\treturn {};\n};\n\nexport const populateInitialData = ( data?: {\n\tstate?: Record< string, unknown >;\n\tconfig?: Record< string, unknown >;\n} ) => {\n\tif ( isObject( data?.state ) ) {\n\t\tObject.entries( data!.state ).forEach( ( [ namespace, state ] ) => {\n\t\t\tstore( namespace, { state }, { lock: universalUnlock } );\n\t\t} );\n\t}\n\tif ( isObject( data?.config ) ) {\n\t\tObject.entries( data!.config ).forEach( ( [ namespace, config ] ) => {\n\t\t\tstoreConfigs.set( namespace, config );\n\t\t} );\n\t}\n};\n\n// Parse and populate the initial state and config.\nconst data = parseInitialData();\npopulateInitialData( data );\n"],"mappings":"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","ignoreList":[]}